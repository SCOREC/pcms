# source files to compile
set(SRCS app1.cc
	cpl_init.cc)
# any headers which need to be public/installed
#  this does not need to be ALL headers
set(HDRS cpl_init.h)

set(LIB_NAME wdm_coupler)

set(USER_LIB "/users/adesoa/dev")
set(ADIOS2_INCLUDE_DIRS "${USER_LIB}/install/ADIOS2/include")
set(ADIOS2_INC "${USER_LIB}/install/ADIOS2/lib64")
set(CMAKE_PREFIX_PATH ${CMAKE_PREFIX_PATH} ${ADIOS2_INC} )

find_package(MPI REQUIRED)
include_directories(${MPI_INCLUDE_DIRS})

find_library(ADIOS2_LIB NAMES adios2 libadios2)
include_directories(${ADIOS2_INCLUDE_DIRS})

if(NOT ADIOS2_LIB)
  message(STATUS "adios2 library not found")
else()
  message(STATUS "adios2 library was found")
  message(STATUS "${ADIOS2_INCLUDE_DIRS}")
endif()

find_package(ADIOS REQUIRED)
include_directories(${ADIOS_INCLUDE_DIRS})

set(LINK_LIBS ${LINK_LIBS} ${MPI_LIBRARIES} ${ADIOS_LIBRARIES} ${ADIOS2_LIB})
set(INCLUDE_DIRS ${INCLUDE_DIRS} ${MPI_INCLUDE_PATH} ${ADIOS_INCLUDE_DIRS} ${ADIOS2_INCLUDE_DIRS})

add_library(${LIB_NAME} ${SRCS})


target_include_directories(${LIB_NAME} PUBLIC
  $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
  $<INSTALL_INTERFACE:include>
  ${INCLUDE_DIRS}
  )

target_link_libraries(${LIB_NAME} ${LINK_LIBS})

install(FILES ${HDRS} DESTINATION include)
install(TARGETS ${LIB_NAME} LIBRARY DESTINATION lib ARCHIVE DESTINATION lib)
